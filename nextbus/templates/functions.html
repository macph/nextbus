{# Functions for templates #}

{# Sets up search form #}
{% macro search_form(query=none, class=none) -%}
<form class="form{% if class %} {{ class }}{% endif %}" action="{{ g.action }}" method="post" name="search">
    {% set aria = {'aria-label': 'Find a bus stop'} %}
    {% set q = query if query is not none else '' %}
    {{ g.form.hidden_tag() }}
    {{ g.form.search(placeholder="Find a bus stop...", id='search-form', value=q, required=g.form.search.flags.required, **aria) }}
    <button id="submit-form" name="submit" type="submit" title="Search" value="1">
        <img src="{{ url_for('static', filename='icons/sharp-search-24px.svg') }}" width="20px" height="20px" alt="Search">
    </button>
</form>
{%- endmacro %}

{# Replaces header with search functionality #}
{% macro add_search_bar(map=true) -%}
<div class="outer-header">
    <header class="header">
        <a class="header__home" href="{{ url_for('page.index') }}">nextbus</a>
        {% if map %}
        <a class="header__right" href="{{ url_for('page.show_map') }}" title="Map">
          <img src="{{ url_for('static', filename='icons/sharp-map-24px-white.svg') }}" alt="Map">
        </a>
        {% endif %}
        <a id="header-search-button" class="header__right" title="Search">
          <img id="header-search-open" src="{{ url_for('static', filename='icons/sharp-search-24px-white.svg') }}" alt="Search">
          <img id="header-search-close" style="display: none" src="{{ url_for('static', filename='icons/sharp-close-24px-white.svg') }}" alt="Close">
        </a>
    </header>
    <div id="header-search-bar" class="hidden search-bar">
        {{ search_form(class='search-bar__form') }}
    </div>
</div>
<script>
    addSearchBarEvents();
</script>
{%- endmacro %}

{# Prints an inline list, using strong tags if required #}
{% macro print_inline(items, strong=true) -%}
{% if items|length == 1 %}
{% if strong %}<strong>{{ items[0] }}</strong>{% else %}{{ items[0] }}{% endif %}
{% elif items|length > 1 %}
{% set next = joiner() %}
{% if strong %}
{% for i in items[:-1] %}{{ next() }}<strong>{{ i }}</strong>{% endfor %} and <strong>{{ items[-1] }}</strong>
{% else %}
{% for i in items[:-1] %}{{ next() }}{{ i }}{% endfor %} and {{ items[-1] }}
{% endif %}
{% else %}
{% endif %}
{%- endmacro %}

{# Prints a list of groups, using <hr> to separate them #}
{% macro print_groups(list_groups) -%}
{% set ctx = {'first': true} %}
{% for name, group in list_groups %}
{% if ctx.first %}
{% if ctx.update({'first': false}) %}{% endif %} {# Updates dictionary without printing anything #}
{% else %}
<hr/>
{% endif %}
{{ caller(name, group ) }}
{% endfor %}
{%- endmacro %}

{# Prints a list using callers #}
{% macro print_list(items, class=none, name=none) -%}
<ul class="list{% if class %}{{ ' %s'|format(class) }}{% endif %}" {% if name %}id="{{ name }}"{% endif %}>
    {% for i in items %}
    <li>{{ caller(i) }}</li>
    {% endfor %}
</ul>
{%- endmacro %}

{# Prints a list of indices from dictionary #}
{% macro print_index(items) -%}
<ul class="list-index">
    {% for name, _ in items|dictsort %}
    <li><a href="#{{ name }}"><span>{{ name }}</span></a></li>
    {% endfor %}
</ul>
{%- endmacro %}

{# Prints the stop indicator #}
{% macro print_stop_indicator(stop, reverse=false, name=none) -%}
<div class="indicator{{ ' indicator--reversed' if reverse else '' }} area-{{ stop.admin_area_ref }}" {% if name %}id="{{ name }}"{% endif %}>
    {% if stop.short_ind != '' %}
    <span>{{ stop.short_ind }}</span>
    {% elif stop.stop_type in ['BCT', 'BCS', 'GBCS', 'GCLS', 'GPBS'] %}
    <img src="{{ url_for('static', filename='img/bus-white.svg') }}" width="28px" alt="Bus stop">
    {% elif stop.stop_type in ['PLT', 'GTMU'] %}
    <img src="{{ url_for('static', filename='img/tram-white.svg') }}" width="28px" alt="Tram stop">
    {% endif %}
</div>
{%- endmacro %}


{% macro stop_description(stop) -%}
{% set dir = {"N": "northbound", "NE": "northeast bound", "E": "eastbound", "SE": "southeast bound",
              "S": "southbound", "SW": "southwest bound", "W": "westbound", "NW": "northwest bound"} %}
{% if stop.street is not none and stop.bearing is not none %}
<strong>{{ stop.street }}</strong>, {{ dir.get(stop.bearing, "") }}
{% elif stop.street is not none %}
<strong>{{ stop.street }}</strong>
{% elif stop.bearing is not none %}
{{ dir.get(stop.bearing, "")|capitalize }}
{% endif %}
{%- endmacro %}