{# Functions for templates #}

{# Footer #}
{% macro footer() -%}
<footer>
  <p>&copy; Ewan Macpherson and data sources, 2017&ndash;19. <a href="{{ url_for('page.about') }}">About this website</a></p>
</footer>
{%- endmacro %}

{# Search icon from Google Material UI #}
{% macro bus_icon() -%}
<svg width="24" height="24" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg">
  <g transform="translate(.3766 -271.9)">
    <path d="m1.092 275.5c-.1735 0-.3142.1407-.3142.3143 0 .1735.1407.3142.3142.3142.1735 0 .3142-.1407.3142-.3142 0-.1736-.1407-.3143-.3142-.3143zm0 .158
    c.08631 0 .1563.0699.1563.1563 0 .0863-.06995.1563-.1563.1563-.08634 0-.1563-.07-.1563-.1563 0-.0864.06998-.1563.1563-.1563z"></path>
    <path d="m4.2 275.5c-.1735 0-.3143.1407-.3143.3143 0 .1735.1407.3142.3143.3142.1735 0 .3142-.1407.3142-.3142 0-.1736-.1407-.3143-.3142-.3143zm0 .158c.08634
    0 .1563.0699.1563.1563 0 .0863-.06998.1563-.1563.1563-.08631 0-.1563-.07-.1563-.1563 0-.0864.06996-.1563.1563-.1563z"></path>
    <path d="m-.0864 274.1c-.02233-.001-.1119.002-.1163.1372l-.02737.7947s-.0803.006-.0803.0752v.6204s-.003469.1828.1726.1828h.85c-.007912-.0309-.0121-.0636
    -.0121-.0971 0-.2163.1753-.3916.3916-.3916.2162 0 .3915.1753.3915.3916 0 .0336-.00422.066-.01219.0971h2.349c-.00792-.0309-.01205-.0636-.01205-.0971 0-.2163
    .1753-.3916.3915-.3916.2163 0 .3915.1753.3915.3916 0 .0336-.00422.066-.0122.0971l1.328-.2563v-1.174c0-.1402-.1316-.3794-.3777-.3794h-5.611s-.001843-.00028
    -.004986-.00046zm.2494.3132h.2194c.0472 0 .08544.0382.08544.0855v1.134c0 .0471-.03825.0855-.08544.0855h-.2194c-.04721 0-.0855-.0382-.0855-.0855v-1.134c0
    -.0473.03828-.0855.0855-.0855zm.6657 0h.922c.04721 0 .08544.0382.08544.0855v.3709c0 .0472-.03823.0854-.08544.0854h-.922c-.04719 0-.08544-.0382-.08544-.0854
    v-.3709c0-.0473.03825-.0855.08544-.0855zm1.289 0h.922c.04721 0 .0855.0382.0855.0855v.3709c0 .0472-.03828.0854-.0855.0854h-.922c-.04718 0-.08544-.0382
    -.08544-.0854v-.3709c0-.0473.03826-.0855.08544-.0855zm1.28 0h.9221c.04718 0 .08544.0382.08544.0855v.3709c0 .0472-.03826.0854-.08544.0854h-.9221c-.04718 0
    -.08544-.0382-.08544-.0854v-.3709c0-.0473.03826-.0855.08544-.0855zm1.277 0h.7606c.1296 0 .2407.1088.2407.2452v.2111c0 .0472-.03826.0854-.08544.0854h-.9158
    c-.04718 0-.08544-.0382-.08544-.0854v-.3709c0-.0473.03826-.0855.08544-.0855z"></path>
  </g>
</svg>
{%- endmacro %}

{% macro tram_icon() -%}
<svg width="24" height="24" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg"><g transform="translate(.8365 -274.3)">
  <path d="m2.301 275.6c-0.04922 0-0.08912 0.0399-0.08912 0.0891v0.1105l-0.5274 0.3671 0.5133 0.3654h-0.4194s-0.04725-7e-3 -0.0975 0.0421l-0.0621 0.0625h-2.048
  s-0.1315-2e-3 -0.1662 0.1365l-0.1754 0.6996v0.9388h0.5224v0.1011h0.3087s0.01277 0.2058 0.2155 0.2058c0.2028 0 0.2155-0.2058 0.2155-0.2058h0.2904s0.01278
  0.2058 0.2155 0.2058c0.2027 0 0.2155-0.2058 0.2155-0.2058h2.25s0.01277 0.2058 0.2155 0.2058c0.2027 0 0.2155-0.2058 0.2155-0.2058h0.2904s0.01275 0.2058 0.2155
  0.2058c0.2028 0 0.2155-0.2058 0.2155-0.2058h0.3087v-0.1011h0.5224v-0.9388l-0.1754-0.6996c-0.03469-0.1388-0.1662-0.1365-0.1662-0.1365h-2.048l-0.0621-0.0625
  c-0.05021-0.049-0.0975-0.0421-0.0975-0.0421h-0.4194l0.5133-0.3654-0.5273-0.3671v-0.1105c0-0.0491-0.0399-0.0891-0.08912-0.0891zm0.03745 0.2088 0.5133 0.358
  -0.5133 0.3654-0.5133-0.3654zm-2.527 1.087c0.04841 0 0.08771 0.0393 0.08771 0.0876v0.4c0 0.0484-0.0393 0.0876-0.08771 0.0876h-0.2569c-0.04841 0-0.08766
  -0.0393-0.08766-0.0876l0.1041-0.4c2e-8 0 0.009919-0.0856 0.08982-0.0856zm0.3405 0h0.2394c0.04844 0 0.08771 0.0393 0.08771 0.0876v1.235c0 0.0484-0.03927
  0.0876-0.08771 0.0876h-0.2394c-0.04843 0-0.08766-0.0393-0.08766-0.0876v-1.235c0-0.0484 0.03923-0.0876 0.08766-0.0876zm0.5205 0h0.2394c0.04842 0 0.08766
  0.0393 0.08766 0.0876v1.235c0 0.0484-0.03924 0.0876-0.08766 0.0876h-0.2394c-0.04841 0-0.08771-0.0393-0.08771-0.0876v-1.235c0-0.0484 0.0393-0.0876 0.08771
  -0.0876zm0.5447 0h0.5466c0.04843 0 0.08766 0.0393 0.08766 0.0876v0.4c0 0.0484-0.03923 0.0876-0.08766 0.0876h-0.5466c-0.04843 0-0.08766-0.0393-0.08766-0.0876
  v-0.4c0-0.0484 0.03923-0.0876 0.08766-0.0876zm0.848 0h0.5461c0.04843 0 0.08771 0.0393 0.08771 0.0876v0.4c0 0.0484-0.03928 0.0876-0.08771 0.0876h-0.5461
  c-0.04843 0-0.08766-0.0393-0.08766-0.0876v-0.4c0-0.0484 0.03923-0.0876 0.08766-0.0876zm0.8475 0h0.5466c0.0484 0 0.08766 0.0393 0.08766 0.0876v0.4c0 0.0484
  -0.03926 0.0876-0.08766 0.0876h-0.5466c-0.0484 0-0.08761-0.0393-0.08761-0.0876v-0.4c0-0.0484 0.03922-0.0876 0.08761-0.0876zm0.8521 0h0.2393c0.04846 0 0.08771
   0.0393 0.08771 0.0876v1.235c0 0.0484-0.03925 0.0876-0.08771 0.0876h-0.2393c-0.04846 0-0.08771-0.0393-0.08771-0.0876v-1.235c0-0.0484 0.03925-0.0876 0.08771
   -0.0876zm0.5204 0h0.2394c0.04846 0 0.08771 0.0393 0.08771 0.0876v1.235c0 0.0484-0.03925 0.0876-0.08771 0.0876h-0.2394c-0.0484 0-0.08766-0.0393-0.08766-0.0876
   v-1.235c0-0.0484 0.03926-0.0876 0.08766-0.0876zm0.5799 0 0.1506 2e-3c0.07993 0 0.08987 0.0856 0.08987 0.0856l0.1041 0.4c0 0.0484-0.03923 0.0876-0.08766
   0.0876h-0.2569c-0.04843 0-0.08766-0.0393-0.08766-0.0876v-0.4c0-0.0484 0.03923-0.0877 0.08766-0.0877z"></path>
</g>
</svg>
{%- endmacro %}

{# Prints an inline list, using strong tags if required #}
{% macro print_inline(items, strong=true) -%}
{% if items|length == 1 %}
{% if strong %}<strong>{{ items[0] }}</strong>{% else %}{{ items[0] }}{% endif %}
{% elif items|length > 1 %}
{% set next = joiner() %}
{% if strong %}
{% for i in items[:-1] %}{{ next() }}<strong>{{ i }}</strong>{% endfor %} and <strong>{{ items[-1] }}</strong>
{% else %}
{% for i in items[:-1] %}{{ next() }}{{ i }}{% endfor %} and {{ items[-1] }}
{% endif %}
{% else %}
{% endif %}
{%- endmacro %}

{# Prints a list using callers #}
{% macro print_list(items, class=none, name=none) -%}
<ul class="list{% if class %}{{ ' %s'|format(class) }}{% endif %}" {% if name %}id="{{ name }}"{% endif %}>
  {%- for i in items %}
  <li>{{ caller(i) }}</li>
  {%- endfor %}
</ul>
{%- endmacro %}

{# Prints a list of indices from dictionary #}
{% macro print_index(items) -%}
<ul class="list-index">
    {% for name, _ in items|dictsort %}
    <li><a href="#{{ name }}"><span>{{ name }}</span></a></li>
    {% endfor %}
</ul>
{%- endmacro %}

{# Prints the stop indicator #}
{% macro print_stop_indicator(stop_ind, stop_type, admin_area_ref, reverse=false, name=none) -%}
<span class="indicator{{ ' indicator-reversed' if reverse else '' }} area-{{ admin_area_ref }}" {% if name %}id="{{ name }}"{% endif %}>
  {% if stop_ind != '' -%}
  <span>{{ stop_ind }}</span>
  {%- elif stop_type in ['BCT', 'BCS', 'GBCS', 'GCLS', 'GPBS'] -%}
  {{ bus_icon() }}
  {%- elif stop_type in ['PLT', 'GTMU'] -%}
  {{ tram_icon() }}
  {%- endif %}
</span>
{%- endmacro %}

{% macro stop_description(stop) -%}
{% set dir = {"N": "northbound", "NE": "northeast bound", "E": "eastbound", "SE": "southeast bound",
              "S": "southbound", "SW": "southwest bound", "W": "westbound", "NW": "northwest bound"} %}
{% if stop.street is not none and stop.bearing is not none %}
<strong>{{ stop.street }}</strong>, {{ dir.get(stop.bearing, "") }}
{% elif stop.street is not none %}
<strong>{{ stop.street }}</strong>
{% elif stop.bearing is not none %}
{{ dir.get(stop.bearing, "")|capitalize }}
{% endif %}
{%- endmacro %}

{# Prints operators for a service #}
{% macro print_operators(operators) -%}
{% if operators -%}
<section>
  <h2>Operators</h2>
  <div class="operators">
    {%- for o in operators %}
    <div>
      <h4>{{ o.name }}</h4>
      {% if o.address -%}
      <p>{{ o.split_address|join('<br>'|safe) }}</p>
      {%- endif %}
      {% if o.website or o.email or o.twitter -%}
      {% set break = joiner('<br>'|safe) -%}
      <p class="text-nowrap">
        {% if o.website %}{{ break() }}<a href="{{ o.website }}">{{ o.website }}</a>{% endif %}
        {% if o.email %}{{ break() }}<a href="mailto:{{ o.email }}">{{ o.email }}</a>{% endif %}
        {% if o.twitter %}{{ break() }}<a href="https://twitter.com/{{ o.twitter[1:] if o.twitter.startswith('@') else o.twitter }}">{{ o.twitter }}</a>{% endif %}
      </p>
      {%- endif %}
    </div>
    {%- endfor %}
  </div>
</section>
{%- endif %}
{%- endmacro %}
