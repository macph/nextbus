{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block head %}
    {{ super() }}
    <script>
        function ls(...strings) {
            str = '';
            for (i of strings)
                str += `<li>${i}</li>`;
            return str;
        }
        function getLocation() {
            var output = document.getElementById("output");
            if (!navigator.geolocation) {
                console.log("Browser does not support geolocation.");
                output.innerHTML = ls("Geolocation not supported; try searching by postcode.");
                return;
            }
            var success = function(position) {
                var lat = position.coords.latitude.toFixed(6);
                var long = position.coords.longitude.toFixed(6);
                output.innerHTML = ls(`Your position is ${lat}, ${long}. I know where you live now.`);
            }
            var error = function(err) {
                console.log("Geolocation error: " + err);
                output.innerHTML = ls("Unable to retrieve your location.");
            }
            navigator.geolocation.getCurrentPosition(success, error);
        }
    </script>
{% endblock %}

{% block heading %}
<h1>Live bus times</h1>
{% endblock %}

{% block content %}
<h2>Search for bus stops</h2>
<div class="search-box">
    <form class="search-form" method="post" name="sms">
        {{ form_naptan.hidden_tag() }}
        <div class="search-label">
            <label>with SMS code </label>
        </div>
        <div class="search-field">
            {{ form_naptan.code(placeholder="eg 55677") }}
        </div>
        <div class="search-submit">
            <input class="form-submit" type="submit" name="submit_code" value=">">
        </div>
    </form>
    <div class="search-error">
        {% if form_naptan.code.errors %}
        {% for error in form_naptan.code.errors %}
        <p>{{ error }}</p>
        {% endfor %}
        {% endif %}
    </div>
    <form class="search-form" action="" method="post" name="postcode">
        {{ form_postcode.hidden_tag() }}
        <div class="search-label">
            <label>with postcode </label>
        </div>
        <div class="search-field">
            {{ form_postcode.postcode(placeholder="eg SW1A 0AA") }}
        </div>
        <div class="search-submit">
            <input class="form-submit" type="submit" name="submit_postcode" value=">">
        </div>
    </form>
    <div class="search-error">
        {% if form_postcode.postcode.errors %}
        {% for error in form_postcode.postcode.errors %}
        <p>{{ error }}</p>
        {% endfor %}
        {% endif %}
    </div>
    <!--<p>Use your location: <input class="form-submit" onclick="getLocation()" type="submit" value="go"></p><p>(note: won't work without HTTPS).</p>-->
    <p align="center"><a href="{{ url_for('page.list_regions') }}">Browse all regions</a></p>
</div>
{% endblock %}