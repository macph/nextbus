{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block head %}
    {{ super() }}
    <script>
        function ls(...strings) {
            str = '';
            for (i of strings)
                str += `<li>${i}</li>`;
            return str;
        }
        function getLocation() {
            var output = document.getElementById("output");
            if (!navigator.geolocation) {
                console.log("Browser does not support geolocation.");
                output.innerHTML = ls("Geolocation not supported; try searching by postcode.");
                return;
            }
            var success = function(position) {
                var lat = position.coords.latitude.toFixed(6);
                var long = position.coords.longitude.toFixed(6);
                output.innerHTML = ls(`Your position is ${lat}, ${long}. I know where you live now.`);
            }
            var error = function(err) {
                console.log("Geolocation error: " + err);
                output.innerHTML = ls("Unable to retrieve your location.");
            }
            navigator.geolocation.getCurrentPosition(success, error);
        }
    </script>
{% endblock %}
{% block content %}
    <div id="divSearch">
        <h2>Search for a stop</h2>
        <form id="formSMS" method="post" name="sms">
            {{ form_naptan.hidden_tag() }}
            <label>with SMS code </label>
            {{ form_naptan.code(size=16, placeholder="eg 55677") }}
            <input class="form-submit" type="submit" name="submit_code" value=">">
        </form>
        <form id="formPS" action="" method="post" name="postcode">
            {{ form_postcode.hidden_tag() }}
            <label>with postcode </label>
            {{ form_postcode.postcode(size=16, placeholder="eg SW1A 0AA") }}
            <input class="form-submit" type="submit" name="submit_postcode" value=">">
        </form>
        <p>Use your location: <input class="form-submit" onclick="getLocation()" type="submit" value="go"></p><p>(note: won't work without HTTPS).</p>
        <p><a href="{{ url_for('page.list_regions') }}">Browse all regions</a></p>
        <ul id="output">
            {% if form_naptan.code.errors %}
            {% for error in form_naptan.code.errors %}
            <li>{{ error }}</li>
            {% endfor %}
            {% endif %}
            {% if form_postcode.postcode.errors %}
            {% for error in form_postcode.postcode.errors %}
            <li>{{ error }}</li>
            {% endfor %}
            {% endif %}
        </ul>
        
    </div>
{% endblock %}