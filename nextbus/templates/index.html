{% extends "base.html" %}
{% block title %}Index{% endblock %}

{% block main %}
<main class="content content--center">
    <div class="heading">
        <h1>Live bus times in Great Britain</h2>
    </div>
    <div class="search-box-above"></div>
    <section class="box-item search-box">
        <form class="search-form" action="" method="post" name="search">
            {{ g.form.hidden_tag() }}
            <label class="label-hidden" for="search-form">Find a bus stop</label>
            {{ g.form.search_query(placeholder="Find a bus stop...", id='search-form', autofocus=true, required=g.form.search_query.flags.required) }}
            {{ g.form.submit_query(id='submit-form') }}
        </form>
        <ul id="search-box-links" class="search-box__links">
            <li><a href="{{ url_for('page.list_regions') }}">Browse all regions</a></li>
            <li><a id="expand-help-content">Help with searching</a></li>
        </ul>
        <div id="help-content" class="search-box__hidden-help">
            <h3>What can I search?</h3>
            <p>
                A <strong>SMS code</strong>&mdash;every stop in Great Britain has a numeric or alphabetic code which should be visible on the bus stop sign or on the information panel.
            </p>
            <p>
                A <strong>postcode</strong>&mdash;you can find stops within 500 metres around a postcode.
            </p>
            <p>
                <strong>Stop names, streets, areas</strong>&mdash;the names of stops or areas can be searched. You can add place, town or city names to help narrow down your search.
            </p>
        </div>
    </section>
    <div class="search-box-below"></div>
</main>
{% endblock %}

{% block script %}
<script>
    let helpHidden = true;
    let helpLink = document.getElementById('expand-help-content');
    let helpContent = document.getElementById('help-content');
    helpLink.addEventListener('click', function() {
        helpContent.style.height = (helpHidden) ? helpContent.scrollHeight + 'px' : '';
        helpHidden = !helpHidden;
    });
    window.addEventListener('resize', function() {
        if (!helpHidden) {
        // Reset height, otherwise scrollHeight's value will just increase
        helpContent.style.height = 'auto';
        helpContent.style.height = helpContent.scrollHeight + 'px';
        }
    })
</script>
{% if config.get('GEOLOCATION_ENABLED') %}
<script>
    let firstLink = document.getElementById('search-box-links').children[0];
    let geoLink = document.createElement('li');
    let geoAnchor = document.createElement('a');
    geoAnchor.textContent = 'Find nearby stops';
    addGeolocation('{{ url_for("page.list_near_location", lat_long="") }}', geoAnchor);
    geoLink.appendChild(geoAnchor);
    firstLink.insertAdjacentElement('afterend', geoLink);
</script>
{% endif %}
{% endblock %}