{% import 'functions.html' as f %}
{% extends "base.html" %}
{% block title %}Map{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
{% endblock %}

{% block outer_header %}
{{ f.add_search_bar() }}
{% endblock %}

{% block main %}
<main class="content content--map">
    <div id="map" class="full-map"></div>
    <div class="map-panel">
        <div id="panel-content" class="map-panel__content">
            <div id="panel-heading-outer" class="heading heading--panel">
                <h1 id="panel-heading">Loading map...</h1>
            </div>
        </div>
        <div class="map-panel__footer">
            <footer class="footer footer--panel">
                <span class="footer__text">
                    &copy; Ewan Macpherson and data sources, 2017&ndash;18. <a href="{{ url_for('page.about') }}">About this website</a>
                </span>
            </footer>
        </div>
    </div>
</main>
{% endblock %}

{% block outer_footer %}
{% endblock %}

{% block script %}
<script>
    const BUS_SVG = "{{ url_for('static', filename='img/bus-white.svg') }}";
    const TRAM_SVG = "{{ url_for('static', filename='img/tram-white.svg') }}";
    const BOX_URL = "{{ url_for('api.get_stops_within') }}";
    const LIVE_URL = "{{ url_for('api.stop_get_times', atco_code='') }}";
    const MAP_URL = "{{ url_for('page.show_map') }}";
    const TILE_URL = "{{ url_for('api.get_stops_tile') }}";
</script>
<script>
    let mapContainer = document.getElementById('map');
    let mapPanel = document.getElementById('panel-content');

    let map = new StopMap('{{ config.get("MAPBOX_APP_TOKEN") }}', mapContainer, mapPanel);
    map.init({{ latitude }}, {{ longitude }}, {{ zoom }});
</script>
{% endblock %}
