{% import 'functions.html' as f %}
{% extends 'base.html' %}
{% block title %}Search results{% endblock %}

{% block nav %}
<ul class="breadcrumbs">
    <li><a href="{{ url_for('page.index') }}">Back to home page</a></li>
</ul>
{% endblock %}

{% block heading %}
<h1>Results for "{{ query }}"</h1>
{% endblock %}

{% block content %}
<div class="search-box box-upper-margin">
    <form class="search-form" method="post" name="search">
        {{ g.form.hidden_tag() }}
        <div class="search-field">
            {{ g.form.search_query(placeholder="Another place or stop...", value=query, required=g.form.search_query.flags.required) }}
        </div>
        <div class="search-submit">
            <input class="form-submit" type="submit" name="submit_query" value=">">
        </div>
    </form>
</div>
{% if error %}
<div class="nothing-found">
    <p>{{ error }}</p>
</div>
{% else %}
<h2>Results</h2>
<p>{{ types }}</p>
<p>{{ areas }}</p>
{% if results.items %}
<div class="list list-places-search">
    {% for r in results.items %}
    {% if r.table_name == 'region' %}
    <a class="item-place item-area-search" href="{{ url_for('page.list_in_region', region_code=r.code) }}">{{ r.name }}</a>
    {% elif r.table_name == 'admin_area' %}
    <a class="item-place item-area-search" href="{{ url_for('page.list_in_area', area_code=r.code) }}">{{ r.name }}</a>
    {% elif r.table_name == 'district' %}
    <a class="item-place item-area-search" href="{{ url_for('page.list_in_district', district_code=r.code) }}">{{ r.name }}, {{ r.admin_area_name }}</a>
    {% elif r.table_name == 'locality' %}
    <a class="item-place item-place-search" href="{{ url_for('page.list_in_locality', locality_code=r.code) }}">{{ r.name }}, {{ r.district_name if r.district_name else r.admin_area_name }}</a>
    {% elif r.table_name == 'stop_point' %}
    {% set sep = joiner() %}
    <a class="item-stop item-stop-search" href="{{ url_for('page.stop_atco', atco_code=r.code) }}">
        {{ f.print_stop_indicator(r) }}
        <div class="stop-label">{{ r.name }}</div>
        <div class="stop-label stop-description">{% if r.street %}{{ sep() }}{{ r.street }}{% endif %}{% if r.locality_name %}{{ sep() }}{{ r.locality_name }}{% endif %}{{ sep() }}{{ r.district_name if r.district_name else r.admin_area_name }}</div>
    </a>
    {% elif r.table_name == 'stop_area' %}
    {% set sep = joiner() %}
    <a class="item-stop item-stop-search" href="{{ url_for('page.stop_area', stop_area_code=r.code) }}">
        {{ f.print_stop_indicator(r, area=true) }}
        <div class="stop-label">{{ r.name }}</div>
        <div class="stop-label stop-description">{% if r.locality_name %}{{ sep() }}{{ r.locality_name }}{% endif %}{{ sep() }}{% if r.district_name %}{{ r.district_name }}{% else %}{{ r.admin_area_name }}{% endif %}</div>
    </a>
    {% endif %}
    {% endfor %}
</div>
{% else %}
<p>No results matching your criteria can be found.</p>
{% endif %}
{{ f.resize_indicator("stop-ind") }}
{{ f.resize_indicator("stop-area-ind", true) }}
{% endif %}
{% endblock %}