{% import 'functions.html' as f %}
{% extends "base.html" %}
{% block title %}Search results{% endblock %}

{% block nav %}
<ul class="breadcrumbs">
    <li><a href="{{ url_for('page_ns.index') }}">Back to home page</a></li>
</ul>
{% endblock %}

{% block heading %}
<h1>Results for '{{ query }}'</h1>
{% endblock %}

{% block content %}
<div class="search-box box-upper-margin">
    <form class="search-form" method="post" name="search">
        {{ g.form.hidden_tag() }}
        <div class="search-label">
            <label>Search again:</label>
        </div>
        <div class="search-field">
            {{ g.form.search_query(placeholder="another place or stop", required=g.form.search_query.flags.required) }}
        </div>
        <div class="search-submit">
            <input class="form-submit" type="submit" name="submit_query" value=">">
        </div>
    </form>
</div>
{% if error %}
<div class="nothing-found">
    <p>{{ error }}</p>
</div>
{% else %}
<div class="select-area-list" id="dFilterAreas"></div>
{% if results.get('area') %}
<h2 id="hArea">Areas</h2>
<div class="list list-places-search" id="dAreas">
    {% for area in results['area'] %}
    {% if area.table_name == 'admin_area' %}
    <a class="item-place item-area-search" data-admin-area="{{ area.admin_area_name }}" href="{{ url_for('page.list_in_area', area_code=area.code) }}">{{ area.name }}</a>
    {% elif area.table_name == 'district' %}
    <a class="item-place item-area-search" data-admin-area="{{ area.admin_area_name }}" href="{{ url_for('page.list_in_district', district_code=area.code) }}">{{ area.name }}, {{ area.admin_area_name }}</a>
    {% endif %}
    {% endfor %}
</div>
{% endif %}
{% if results.get('locality') %}
<h2 id="hPlace">Places</h2>
{% if local_limit %}
<p>Extra results for '{{ query }}' truncated. Try narrowing your search - for example, you can add the name of the area to the query.</p>
{% endif %}
<div class="list list-places-search" id="dPlace">
    {% for locality in results['locality'] %}
    <a class="item-place item-place-search" data-admin-area="{{ locality.admin_area_name }}" href="{{ url_for('page.list_in_locality', locality_code=locality.code) }}">{{ locality.name }}, {{ locality.district_name if locality.district_name else locality.admin_area_name }}</a>
    {% endfor %}
</div>
{% endif %}
{% if results.get('stop') %}
<h2 id="hStop">Stops</h2>
{% if stops_limit %}
<p>Extra results for '{{ query }}' truncated. Try narrowing your search - for example, you can add the name of the area to the query.</p>
{% endif %}
<div class="list list-stops-search" id="dStops">
    {% for stop in results['stop'] %}
    {% if stop.table_name == 'stop_point' %}
    {% set sep = joiner() %}
    <a class="item-stop item-stop-search" data-admin-area="{{ stop.admin_area_name }}" href="{{ url_for('page.stop_atco', atco_code=stop.code) }}">
        <div class="indicator stop-ind area-color-{{ stop.code[:3] }}"><span>{{ stop.indicator }}</span></div>
        <div class="stop-label">{{ stop.name }}</div>
        <div class="stop-label stop-description">{% if stop.street %}{{ sep() }}{{ stop.street }}{% endif %}{% if stop.locality_name %}{{ sep() }}{{ stop.locality_name }}{% endif %}{{ sep() }}{{ stop.district_name if stop.district_name else stop.admin_area_name }}</div>
    </a>
    {% elif stop.table_name == 'stop_area' %}
    {% set sep = joiner() %}
    <a class="item-stop item-stop-search" data-admin-area="{{ stop.admin_area_name }}" href="{{ url_for('page.stop_area', stop_area_code=stop.code) }}">
        <div class="indicator stop-area-ind area-color-{{ stop.code[:3] }}"><span>{{ stop.indicator }}</span></div>
        <div class="stop-label">{{ stop.name }}</div>
        <div class="stop-label stop-description">{% if stop.locality_name %}{{ sep() }}{{ stop.locality_name }}{% endif %}{{ sep() }}{% if stop.district_name %}{{ stop.district_name }}{% else %}{{ stop.admin_area_name }}{% endif %}</div>
    </a>
    {% endif %}
    {% endfor %}
</div>
{% endif %}
<script>
    var fl = new SearchFilterList();
    fl.init();
</script>
{{ f.resize_indicator("stop-ind") }}
{{ f.resize_indicator("stop-area-ind", true) }}
{% endif %}
{% endblock %}