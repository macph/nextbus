{% import 'functions.html' as f %}
{% extends 'base.html' %}

{% block title %}{{ f.stop_full_name(stop) }}{% endblock %}

{% block outer_header %}
{{ f.add_search_bar() }}
{% endblock %}

{% block heading %}
<nav>
    <ul class="breadcrumbs breadcrumbs--trailing">
        <li><a href="{{ url_for('page.list_regions') }}">All regions</a></li>
        <li>&sdot;&sdot;&sdot;</li>
        {% if stop.locality.district is not none %}
        <li><a href="{{ url_for('page.list_in_district', district_code=stop.locality.district.code) }}">{{ stop.locality.district.name }}</a></li>
        {% else %}
        <li><a href="{{ url_for('page.list_in_area', area_code=stop.locality.admin_area.code) }}">{{ stop.locality.admin_area.name }}</a></li>
        {% endif %}
        <li><a href="{{ url_for('page.list_in_locality', locality_code=stop.locality.code) }}">{{ stop.locality.name }}</a></li>
    </ul>
</nav>
<div class="heading-stop">
    {{ f.print_stop_indicator(stop) }}
    <h1>{{ stop.name }}</h1>
</div>
{% if stop.street or stop.bearing %}
{% set pipe = joiner() %}
<p>{% if stop.street is not none %}{{ pipe() }}<strong>{{ stop.street }}</strong>{% endif %}<!--
-->{% if stop.bearing is not none %}{{ pipe() }}{{ stop.bearing }}-bound{% endif %}</p>
{% endif %}
{% endblock %}

{% block content %}
<div class="columns">
    <div class="column-2">
        <section class="card card--min-height">
            <div class="heading-inline heading-inline--right">
                <h2 id="liveTime">Retrieving live data...</h2>
                <p id="liveCountdown"></p>
            </div>
            <div id="services"></div>
        </section>
    </div>
    <div class="column-1">
        <section class="card card--aside">
            <h3><a href="{{ url_for('page.show_map_with_stop', atco_code=stop.atco_code) }}">View on map</a></h3>
        </section>
        <section class="card card--aside">
            <h2>Stop information</h2>
            <p>
                {% set pipe = joiner() %}
                {% if stop.street is not none %}{{ pipe() }}<strong>{{ stop.street }}</strong>{% endif %}<!--
             -->{% if stop.crossing is not none and stop.crossing != stop.street %}{{ pipe() }}{{ stop.crossing }}{% endif %}<!--
             -->{% if stop.landmark is not none and stop.landmark != stop.crossing %}{{ pipe() }}{{ stop.landmark }}{% endif %}
            </p>
            <p>SMS code <strong>{{ stop.naptan_code}}</strong></p>
        </section>
        {% if stop.stop_area_ref is not none %}
        <section class="card card--aside">
            <h2>Other stops</h2>
            <p><a href="{{ url_for('page.stop_area', stop_area_code=stop.stop_area.code) }}">{{ stop.stop_area.name }}</a></p>
        </section>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block script %}
<script>
        resizeIndicator('indicator');
    LIVE_URL = "{{ url_for('api.stop_get_times', atco_code='') }}";
    let ld = new LiveData(
        '{{ stop.atco_code }}',
        '{{ stop.admin_area_ref }}',
        'services',
        'liveTime',
        'liveCountdown'
    )
    ld.startLoop();
</script>
{% endblock %}